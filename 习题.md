## 响应式编程边界

2. 学习和使用debounce

```
let searchText = PassthroughSubject<String, Never>()
var stringUrl = "https://httpbin.org/get?foo="
let debounce = searchText.debounce(for: .seconds(1), scheduler:RunLoop.main)

var debounceTmp = check("Debounce") {
    debounce
}


//使用sink或者assgin订阅某个publisher时，必须要持有返回值才能让这个订阅正常工作
// debounce后每隔1秒发送一次，第一次发送的就是I Love SwiftUI
// 第二次发送的I Love SwiftUI And Combine
var result = debounce.sink(receiveValue: { value in
    print("stringUrl--------\(stringUrl)")
    URLSession.shared.dataTaskPublisher(for: URL(string: stringUrl)!)
})

// 每次发送新值就拼接起来 
let temp1 = searchText.sink(receiveValue: { value in
    stringUrl.append(value)
})

delay(0.1) { searchText.send("I") }
delay(0.2) { searchText.send("Love") }
delay(0.5) { searchText.send("SwiftUI") }
delay(1.6) { searchText.send("And") }
delay(2.0) { searchText.send("Combine") }

```

控制台输出：
```
----- Debounce -----
receive subscription: (Debounce)
request unlimited

receive value: (SwiftUI)
stringUrl--------https://httpbin.org/get?foo=ILoveSwiftUI
receive value: (Combine)
stringUrl--------https://httpbin.org/get?foo=ILoveSwiftUIAndCombine

```

## SwiftUI架构

1. 登录时使用UIActivityIndicatorView
创建一个自定义的View
``` swift
import Foundation
import SwiftUI

struct YLActivityIndicatorView: UIViewRepresentable {
        
    func makeUIView(context: Context) -> some UIView {
        let indicatorView = UIActivityIndicatorView(style: .medium)
        indicatorView.backgroundColor = .yellow
        indicatorView.startAnimating()
        return indicatorView
    }
    
    
    func updateUIView(_ uiView: UIViewType, context: Context) {
    }
}

```

SettingView中
```swift
        if settings.loginRequesting {
//                    Text("登录中...")
            YLActivityIndicatorView()

        } else {
            Button(settings.accountBehavior.text) {
                print("登录/注册")
                self.store.dispatch(.login(email: self.settings.email, password: self.settings.password))
            }
        }
```

![WX20201227-220743@2x.png](http://ww1.sinaimg.cn/mw690/006WHNMxgy1gm2ro0n4d6j30lo1dstcm.jpg)
